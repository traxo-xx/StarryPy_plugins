<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>

<meta name="Description" content="Information architecture, Web Design, Web Standards." />
<meta name="Keywords" content="your, keywords" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="Distribution" content="Global" />
<meta name="Author" content="Erwin Aligam - ealigam@gmail.com" />
<meta name="Robots" content="index,follow" />

<link rel="stylesheet" href="css/PixelGreen.css" type="text/css" />
    <script type="text/javascript">
        var ws;

        function createChatEntry(msgdate, username, message) {
            var entry = document.createElement("div");
            entry.class = "chat_entry";

            var dom_msgdate = document.createElement("span");
            dom_msgdate.class = "chat_msgdate";
            dom_msgdate.innerHTML = msgdate + " ";
            entry.appendChild(dom_msgdate);

            var dom_uname = document.createElement("span");
            dom_uname.class = "chat_username";
            dom_uname.innerHTML = username + ": ";
            entry.appendChild(dom_uname);

            var dom_msg = document.createElement("span");
            dom_msg.class = "chat_message";
            dom_msg.innerHTML = message;
            entry.appendChild(dom_msg);

            return entry;
        }

        function openWS(messageContainer) {
            ws = new WebSocket("ws://localhost:8083/chat");
            ws.onmessage = function (e) {
                var data = JSON.parse(e.data);
                messageContainer.appendChild(createChatEntry(data.msgdate, data.author, data.message));
            };
            ws.onclose = function (e) {
                openWS(messageContainer);
            };
        }

        function sendMessage() {
            var d = new Date();
            var data = { msgdate: "[" + d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds() + "]",
                author: document.getElementById("username").value,
                message: document.getElementById("message").value };

            if (data.author && data.message) {
                ws.send(JSON.stringify(data));
            }
        }

        window.onload = function () {
            var d = new Date();
            var msgdate = "[" + d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds() + "]";
            var messageContainer = document.getElementById("chat");
            if ("WebSocket" in window) {
                messageContainer.appendChild(createChatEntry(msgdate, "[SYSTEM]", "WebSocket is supported by your browser!"));
                openWS(messageContainer);
            }
            else {
                messageContainer.appendChild(createChatEntry(msgdate, "[SYSTEM]", "WebSocket is NOT supported by your browser!"));
            }
        };

        function confirmAction(action) {
            var agree=confirm("Are you sure you want to " + action + " the server?");
            return (agree)
        }

        function stopServer() {
            if (confirmAction("stop")) window.open("/stopserver","_self")
        }

    </script>

<title>StarryPy WebGUI</title>
	
</head>

<body>
<!-- wrap starts here -->
<div id="wrap">

	<div id="header"><div id="header-content">	
		
		<h1 id="logo"><a href="index.html" title="">StarryPy<span class="gray">WebGUI</span></a></h1>
		<h2 id="slogan">Put your site slogan here...</h2>		
		
		<!-- Menu Tabs -->
		<ul>
			<li><a href="index.html" id="current">Home</a></li>
			<li><a href="index.html">News</a></li>
			<li><a href="index.html">Downloads</a></li>
			<li><a href="index.html">Support</a></li>
			<li><a href="index.html">About</a></li>
			<li><a href="logout">Logout</a></li>
		</ul>		
			
	
	</div></div>
	
	<div class="headerphoto"></div>
				
	<!-- content-wrap starts here -->
	<div id="content-wrap"><div id="content">		
		
		<div id="sidebar" >
		
			<div class="sidebox">
				
				<table>
                    {% set row_count = 1 %}
					<tr>
						<th class="first"><strong>Players online: {{ len(handler.playerlistonline) }}</strong></th>
					</tr>
                    {% for player in handler.playerlistonline %}
                        {% set row_class = "row-a" if bool(row_count & 1) else "row-b" %}
					<tr class="{{ row_class }}">
						<td class="first">{{ player.as_dict()["name"] }}</td>
					</tr>
                        {% set row_count +=1 %}
                    {% end %}
				</table>
						
			</div>

			<div class="sidebox">

				<h1 class="clear">Admin Actions</h1>
				<ul class="sidemenu">
					<li><button class="button" onclick="stopServer()">Stop StarryPy</button></li><br>
					<li><button class="button" onclick="stopServer()">Restart Server</button></li>
				</ul>

			</div>

					
		</div>	
	
		<div id="main">		
		
			<div class="post">
			
				<a name="Chat"></a>
				<h1>Chat</h1>
				

                <div id="chat" style="width: 100%; height: 40em; overflow: auto; font-family: Arial"></div>
                <div id="input_area">
                <input id="username" type="hidden" value="{{ handler.current_user }}">
                <input class="search" type="text" id="message" placeholder="Your message" style="display: block; width: 400px" onkeydown="if(event.keyCode==13){sendMessage()}">
                <button class="button" onclick="sendMessage()" style="display: block">Send</button>
                </div>
				
			</div>

				
				<h3>Player List</h3>
							
					<table>
                    {% set row_count = 1 %}
					<tr>
						<th class="first"><strong>post</strong> name</th>
						<th>Planet</th>
						<th>Access Level</th>
						<th>Last Seen</th>
					</tr>
                    {% for player in handler.playerlist %}
                        {% set row_class = "row-a" if bool(row_count & 1) else "row-b" %}
					<tr class="{{ row_class }}">
						<td class="first">{{ player.as_dict()["name"] }}</td>
						<td><a href="index.html">{{ player.as_dict()["planet"] }}</a></td>
						<td><a href="index.html">{{ player.as_dict()["access_level"] }}</a></td>
						<td><a href="index.html">{{ player.as_dict()["last_seen"] }}</a></td>
					</tr>
                        {% set row_count +=1 %}
                    {% end %}
					</table>
				
				<br />				
										
		</div>					
		
	<!-- content-wrap ends here -->		
	</div></div>

<!-- footer starts here -->	
<div id="footer"><div id="footer-content">
	
		<div class="col2 float-right">

            <p>
			&copy; copyright 2010 Your Company Name<br />
			<a href="http://www.bluewebtemplates.com/" title="Website Templates">website templates</a> by <a href="http://www.styleshout.com/">styleshout</a> <br />

			Valid <a href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> |
		   	      <a href="http://validator.w3.org/check/referer">XHTML</a>
			</p>
		</div>
	
</div></div>
<!-- footer ends here -->
	
<!-- wrap ends here -->
</div>

</body>
</html>
